import React, { useState, useEffect, useRef } from 'react';
import { Zap, Crown, Sparkles, TrendingUp, Flame } from 'lucide-react';

const MoneyGenerator = () => {
  const [balance, setBalance] = useState(0);
  const [selectedCurrency, setSelectedCurrency] = useState('USD');
  const [isGenerating, setIsGenerating] = useState(false);
  const [particles, setParticles] = useState([]);
  const [streak, setStreak] = useState(0);
  const [multiplier, setMultiplier] = useState(1);
  const [shockwaves, setShockwaves] = useState([]);
  const [floatingTexts, setFloatingTexts] = useState([]);
  const canvasRef = useRef(null);

  const currencies = [
    { code: 'USD', symbol: '$', name: 'US Dollar', flag: 'üá∫üá∏', color: '#10b981', emoji: 'üíµ' },
    { code: 'EUR', symbol: '‚Ç¨', name: 'Euro', flag: 'üá™üá∫', color: '#3b82f6', emoji: 'üí∂' },
    { code: 'GBP', symbol: '¬£', name: 'British Pound', flag: 'üá¨üáß', color: '#8b5cf6', emoji: 'üí∑' },
    { code: 'JPY', symbol: '¬•', name: 'Japanese Yen', flag: 'üáØüáµ', color: '#ef4444', emoji: 'üí¥' },
    { code: 'CNY', symbol: '¬•', name: 'Chinese Yuan', flag: 'üá®üá≥', color: '#f59e0b', emoji: 'üí¥' },
    { code: 'INR', symbol: '‚Çπ', name: 'Indian Rupee', flag: 'üáÆüá≥', color: '#06b6d4', emoji: 'üí∞' },
    { code: 'AUD', symbol: '$', name: 'Australian Dollar', flag: 'üá¶üá∫', color: '#14b8a6', emoji: 'üíµ' },
    { code: 'CAD', symbol: '$', name: 'Canadian Dollar', flag: 'üá®üá¶', color: '#ec4899', emoji: 'üíµ' },
    { code: 'BRL', symbol: 'R$', name: 'Brazilian Real', flag: 'üáßüá∑', color: '#84cc16', emoji: 'üí∞' },
    { code: 'MXN', symbol: '$', name: 'Mexican Peso', flag: 'üá≤üáΩ', color: '#a855f7', emoji: 'üíµ' },
    { code: 'BDT', symbol: '‡ß≥', name: 'Bangladeshi Taka', flag: 'üáßüá©', color: '#10b981', emoji: 'üí∏' },
    { code: 'AED', symbol: 'ÿØ.ÿ•', name: 'UAE Dirham', flag: 'üá¶üá™', color: '#fbbf24', emoji: 'üí∞' },
  ];

  const getCurrentCurrency = () => currencies.find(c => c.code === selectedCurrency);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let animationId;
    const animate = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw particles with trails
      particles.forEach((particle, index) => {
        particle.y += particle.speedY;
        particle.x += particle.speedX;
        particle.speedY += 0.3; // Gravity
        particle.rotation += particle.rotationSpeed;
        particle.life -= 1;
        particle.opacity = Math.max(0, particle.life / 100);

        ctx.save();
        ctx.translate(particle.x, particle.y);
        ctx.rotate(particle.rotation);
        ctx.globalAlpha = particle.opacity;
        
        // Glow effect
        ctx.shadowBlur = 20;
        ctx.shadowColor = particle.color;
        
        ctx.font = `bold ${particle.size}px Arial`;
        ctx.fillStyle = particle.color;
        ctx.fillText(particle.text, -particle.size/2, particle.size/2);
        
        ctx.restore();

        if (particle.life <= 0 || particle.y > canvas.height) {
          particles.splice(index, 1);
        }
      });

      animationId = requestAnimationFrame(animate);
    };
    animate();

    return () => cancelAnimationFrame(animationId);
  }, [particles]);

  const createShockwave = (x, y) => {
    const wave = { id: Date.now() + Math.random(), x, y };
    setShockwaves(prev => [...prev, wave]);
    setTimeout(() => {
      setShockwaves(prev => prev.filter(w => w.id !== wave.id));
    }, 1000);
  };

  const createFloatingText = (amount) => {
    const text = { 
      id: Date.now(), 
      amount, 
      x: 50 + Math.random() * 50,
      y: 50
    };
    setFloatingTexts(prev => [...prev, text]);
    setTimeout(() => {
      setFloatingTexts(prev => prev.filter(t => t.id !== text.id));
    }, 2000);
  };

  const generateMoney = (e) => {
    if (isGenerating) return;
    
    setIsGenerating(true);
    const baseAmount = Math.floor(Math.random() * 10000) + 5000;
    const finalAmount = Math.floor(baseAmount * multiplier);
    
    setBalance(prev => prev + finalAmount);
    setStreak(prev => prev + 1);

    if ((streak + 1) % 3 === 0) {
      setMultiplier(prev => Math.min(prev + 1, 20));
    }

    const rect = e.currentTarget.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    createShockwave(centerX, centerY);
    createFloatingText(finalAmount);

    // Create massive particle explosion
    const currency = getCurrentCurrency();
    const particleCount = 80;
    const newParticles = Array.from({ length: particleCount }, (_, i) => {
      const angle = (i / particleCount) * Math.PI * 2;
      const speed = Math.random() * 15 + 10;
      return {
        x: centerX,
        y: centerY,
        speedX: Math.cos(angle) * speed,
        speedY: Math.sin(angle) * speed - Math.random() * 5,
        text: Math.random() > 0.5 ? currency.symbol : currency.emoji,
        size: Math.random() * 40 + 30,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.3,
        life: 100,
        opacity: 1,
        color: currency.color
      };
    });

    setParticles(prev => [...prev, ...newParticles]);

    // Vibration effect
    if (navigator.vibrate) {
      navigator.vibrate([50, 30, 50]);
    }

    setTimeout(() => setIsGenerating(false), 200);
  };

  const formatNumber = (num) => {
    if (num >= 1000000000) return `${(num / 1000000000).toFixed(2)}B`;
    if (num >= 1000000) return `${(num / 1000000).toFixed(2)}M`;
    if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;
    return num.toFixed(0);
  };

  return (
    <div className="relative min-h-screen overflow-hidden bg-black">
      <style>{`
        @keyframes gradientShift {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }
        @keyframes float {
          0%, 100% { transform: translateY(0px) rotate(0deg); }
          50% { transform: translateY(-20px) rotate(5deg); }
        }
        @keyframes pulse {
          0%, 100% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.05); opacity: 0.8; }
        }
        @keyframes shockwave {
          0% { transform: scale(0); opacity: 1; }
          100% { transform: scale(4); opacity: 0; }
        }
        @keyframes slideUp {
          0% { transform: translateY(0) scale(1); opacity: 1; }
          100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
        }
        @keyframes rainbow {
          0% { filter: hue-rotate(0deg); }
          100% { filter: hue-rotate(360deg); }
        }
        @keyframes wiggle {
          0%, 100% { transform: rotate(-3deg); }
          50% { transform: rotate(3deg); }
        }
        @keyframes glow {
          0%, 100% { filter: drop-shadow(0 0 10px currentColor) brightness(1); }
          50% { filter: drop-shadow(0 0 30px currentColor) brightness(1.5); }
        }
        .animated-bg {
          background: linear-gradient(45deg, #ff0080, #ff8c00, #40e0d0, #ff0080, #ff8c00);
          background-size: 400% 400%;
          animation: gradientShift 3s ease infinite;
        }
        .glass {
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(20px);
          border: 2px solid rgba(255, 255, 255, 0.1);
        }
        .text-glow {
          text-shadow: 0 0 20px currentColor, 0 0 40px currentColor, 0 0 60px currentColor;
        }
        .neon-border {
          box-shadow: 0 0 20px currentColor, inset 0 0 20px currentColor, 0 0 40px currentColor;
        }
      `}</style>

      {/* Mega animated background */}
      <div className="absolute inset-0 animated-bg opacity-50"></div>
      
      {/* Floating orbs */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        {[...Array(20)].map((_, i) => (
          <div
            key={i}
            className="absolute rounded-full blur-3xl"
            style={{
              width: Math.random() * 300 + 100,
              height: Math.random() * 300 + 100,
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              background: `radial-gradient(circle, ${['#ff0080', '#00ff88', '#00d4ff', '#ffaa00'][i % 4]} 0%, transparent 70%)`,
              animation: `float ${Math.random() * 10 + 10}s ease-in-out infinite`,
              animationDelay: `${Math.random() * 5}s`,
              opacity: 0.3
            }}
          />
        ))}
      </div>

      {/* Shockwaves */}
      {shockwaves.map(wave => (
        <div
          key={wave.id}
          className="absolute rounded-full border-8 pointer-events-none z-30"
          style={{
            left: wave.x,
            top: wave.y,
            width: 100,
            height: 100,
            marginLeft: -50,
            marginTop: -50,
            borderColor: getCurrentCurrency().color,
            animation: 'shockwave 1s ease-out forwards',
            boxShadow: `0 0 50px ${getCurrentCurrency().color}`
          }}
        />
      ))}

      {/* Floating amount texts */}
      {floatingTexts.map(text => (
        <div
          key={text.id}
          className="absolute text-6xl font-black pointer-events-none z-40"
          style={{
            left: `${text.x}%`,
            top: `${text.y}%`,
            color: getCurrentCurrency().color,
            animation: 'slideUp 2s ease-out forwards',
            textShadow: `0 0 30px ${getCurrentCurrency().color}, 0 0 60px ${getCurrentCurrency().color}`
          }}
        >
          +{getCurrentCurrency().symbol}{formatNumber(text.amount)}
        </div>
      ))}

      <canvas ref={canvasRef} className="absolute inset-0 pointer-events-none z-20" />

      <div className="relative z-30 max-w-7xl mx-auto p-4 md:p-8">
        {/* Epic Header */}
        <div className="text-center mb-12">
          <div className="inline-block mb-6" style={{ animation: 'float 3s ease-in-out infinite' }}>
            <h1 className="text-7xl md:text-9xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-pink-500 to-cyan-400 text-glow mb-2"
                style={{ animation: 'rainbow 5s linear infinite' }}>
              üíé MONEY MACHINE üíé
            </h1>
          </div>
          <div className="flex items-center justify-center gap-6 mb-4">
            <Zap className="w-16 h-16 text-yellow-400" style={{ animation: 'glow 1s infinite' }} />
            <p className="text-4xl md:text-5xl font-black text-white text-glow">
              TAP TO GET RICH!
            </p>
            <Flame className="w-16 h-16 text-orange-500" style={{ animation: 'glow 1s infinite' }} />
          </div>
        </div>

        {/* Mega Multiplier Display */}
        {multiplier > 1 && (
          <div className="text-center mb-8" style={{ animation: 'pulse 0.5s infinite' }}>
            <div className="inline-block glass rounded-full px-12 py-6 neon-border"
                 style={{ 
                   animation: 'wiggle 0.3s infinite',
                   borderColor: '#ffd700',
                   color: '#ffd700'
                 }}>
              <Crown className="inline w-12 h-12 mr-4" style={{ animation: 'glow 1s infinite' }} />
              <span className="text-5xl font-black text-glow">{multiplier}x MEGA BOOST!</span>
              <Crown className="inline w-12 h-12 ml-4" style={{ animation: 'glow 1s infinite' }} />
            </div>
          </div>
        )}

        {/* Ultra Balance Display */}
        <div className="relative mb-10">
          <div className="absolute inset-0 rounded-[3rem] blur-3xl opacity-70"
               style={{ 
                 background: `linear-gradient(135deg, ${getCurrentCurrency().color}, #ff0080, #00d4ff)`,
                 animation: 'pulse 2s infinite'
               }}></div>
          
          <div className="relative glass rounded-[3rem] p-12 neon-border"
               style={{ borderColor: getCurrentCurrency().color }}>
            <div className="text-center">
              <Sparkles className="inline w-16 h-16 text-yellow-300 mb-4" style={{ animation: 'glow 1s infinite' }} />
              <p className="text-3xl font-black text-yellow-300 mb-4 uppercase tracking-widest text-glow">
                YOUR FORTUNE
              </p>
              <div className="relative inline-block">
                <div className="text-8xl md:text-[12rem] font-black text-white mb-4 text-glow"
                     style={{ 
                       color: getCurrentCurrency().color,
                       animation: 'pulse 2s infinite'
                     }}>
                  {getCurrentCurrency().symbol}{formatNumber(balance)}
                </div>
              </div>
              <div className="flex items-center justify-center gap-4">
                <span className="text-6xl">{getCurrentCurrency().flag}</span>
                <p className="text-5xl font-black text-white text-glow">{getCurrentCurrency().code}</p>
                <span className="text-6xl">{getCurrentCurrency().emoji}</span>
              </div>
            </div>
          </div>
        </div>

        {/* MEGA Generate Button */}
        <button
          onClick={generateMoney}
          disabled={isGenerating}
          className="w-full relative group mb-10 transform transition-all duration-200"
          style={{ 
            perspective: '1000px',
            animation: isGenerating ? 'pulse 0.3s infinite' : 'float 2s ease-in-out infinite'
          }}
        >
          <div className="absolute inset-0 rounded-[3rem] blur-2xl opacity-80 group-hover:opacity-100"
               style={{ 
                 background: 'linear-gradient(135deg, #00ff88, #00d4ff, #ff0080)',
                 animation: 'rainbow 3s linear infinite'
               }}></div>
          
          <div className="relative glass rounded-[3rem] py-16 border-8 transform group-hover:scale-105 group-active:scale-95 transition-transform"
               style={{ 
                 borderColor: '#00ff88',
                 boxShadow: '0 0 60px #00ff88, inset 0 0 60px rgba(0,255,136,0.3)'
               }}>
            <div className="text-7xl md:text-8xl font-black text-white text-glow flex items-center justify-center gap-6">
              <Zap className="w-20 h-20" style={{ animation: 'glow 0.5s infinite' }} />
              {isGenerating ? (
                <span style={{ animation: 'rainbow 1s linear infinite' }}>üí• EXPLODING! üí•</span>
              ) : (
                <span>üöÄ GENERATE üöÄ</span>
              )}
              <Sparkles className="w-20 h-20" style={{ animation: 'glow 0.5s infinite' }} />
            </div>
          </div>
        </button>

        {/* Stats */}
        <div className="grid grid-cols-3 gap-6 mb-10">
          {[
            { icon: Flame, label: 'STREAK', value: streak, color: '#ff0080' },
            { icon: TrendingUp, label: 'BOOST', value: `${multiplier}x`, color: '#00d4ff' },
            { icon: Crown, label: 'LEVEL', value: Math.floor(streak / 3) + 1, color: '#ffd700' }
          ].map((stat, i) => (
            <div key={i} className="glass rounded-3xl p-8 text-center neon-border"
                 style={{ 
                   borderColor: stat.color,
                   animation: 'float 3s ease-in-out infinite',
                   animationDelay: `${i * 0.2}s`
                 }}>
              <stat.icon className="w-12 h-12 mx-auto mb-3" 
                         style={{ color: stat.color, animation: 'glow 2s infinite' }} />
              <p className="text-white/70 text-lg font-bold mb-2">{stat.label}</p>
              <p className="text-5xl font-black text-white text-glow" style={{ color: stat.color }}>
                {stat.value}
              </p>
            </div>
          ))}
        </div>

        {/* Currency Selector */}
        <div className="glass rounded-[3rem] p-8 neon-border" style={{ borderColor: '#ff8c00' }}>
          <h2 className="text-4xl font-black text-white text-center mb-8 text-glow">
            üåé SELECT CURRENCY üåç
          </h2>
          <div className="grid grid-cols-3 md:grid-cols-6 gap-4">
            {currencies.map((currency, i) => (
              <button
                key={currency.code}
                onClick={() => setSelectedCurrency(currency.code)}
                className={`relative p-6 rounded-2xl font-bold transition-all transform hover:scale-110 ${
                  selectedCurrency === currency.code ? 'scale-110' : ''
                }`}
                style={{
                  background: selectedCurrency === currency.code 
                    ? `linear-gradient(135deg, ${currency.color}, #ff0080)` 
                    : 'rgba(255,255,255,0.05)',
                  boxShadow: selectedCurrency === currency.code 
                    ? `0 0 40px ${currency.color}` 
                    : 'none',
                  animation: selectedCurrency === currency.code ? 'pulse 1s infinite' : 'float 3s ease-in-out infinite',
                  animationDelay: `${i * 0.1}s`,
                  border: selectedCurrency === currency.code ? `3px solid ${currency.color}` : '2px solid rgba(255,255,255,0.1)'
                }}
              >
                <div className="text-5xl mb-2">{currency.flag}</div>
                <div className="text-2xl mb-1">{currency.emoji}</div>
                <div className="text-white font-black">{currency.code}</div>
              </button>
            ))}
          </div>
        </div>

        {/* Reset Button */}
        <button
          onClick={() => {
            setBalance(0);
            setStreak(0);
            setMultiplier(1);
          }}
          className="w-full mt-8 py-6 glass rounded-3xl font-bold text-2xl text-white transition-all transform hover:scale-105 neon-border"
          style={{ 
            borderColor: '#ff0080',
            animation: 'float 4s ease-in-out infinite'
          }}
        >
          üîÑ RESTART EMPIRE
        </button>
      </div>
    </div>
  );
};

export default MoneyGenerator;
